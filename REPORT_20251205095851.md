# Email Classification System ‚Äî Project Report

## Abstract

This project presents an **intelligent email classification and spam detection system** that automatically categorizes incoming emails into five distinct categories: Urgent, Financial, HR, General, and Spam. The system combines machine learning with heuristic-based rule detection to achieve high accuracy in both classification and spam identification.

### Key Highlights
- **Five-Category Classification**: Automatically sorts emails by priority and type
- **Dual-Layer Spam Detection**: ML model + advanced heuristic engine (keyword scoring, pattern matching)
- **High Accuracy**: 100% training and testing accuracy on validation dataset
- **REST API**: Flask backend for seamless integration and automation
- **Interactive Web UI**: Real-time classification with visual feedback and confidence metrics
- **Hybrid Approach**: Combines Logistic Regression (ML) with intelligent pattern detection (heuristics)

### Technical Approach
The system uses a **Logistic Regression model** trained on 5,500+ labeled email samples with **TF-IDF vectorization**. Spam detection employs a **weighted scoring system** that analyzes keywords, URL patterns, capitalization abuse, and punctuation markers. High-priority spam indicators (winner, prize, verify account, etc.) are weighted at +3 points, while patterns like multiple URLs receive +4 points. A threshold of score ‚â• 4 classifies emails as spam.

### Impact
Reduces manual email sorting effort, improves productivity by prioritizing critical messages, and enhances security through reliable spam and phishing detection. The system is extensible and can be retrained with new data for improved accuracy.

---

## Executive Summary
This project is an **AI-powered email classification and spam detection system** built with Flask and scikit-learn. It classifies emails into five categories: **Urgent**, **Financial**, **HR**, **General**, and **Spam**. The system combines a trained machine learning model with intelligent heuristic rules to detect and flag spam emails. A simple web UI allows users to test the classifier interactively.

---

## Project Structure

```
Email Classification System/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ app.py                    # Flask API server (main)
‚îÇ   ‚îú‚îÄ‚îÄ train_model.py            # Model training script
‚îÇ   ‚îú‚îÄ‚îÄ clean_dataset.py          # Data cleaning utilities
‚îÇ   ‚îú‚îÄ‚îÄ auto_label.py             # Auto-labeling helper
‚îÇ   ‚îú‚îÄ‚îÄ email_model.pkl           # Trained classifier (pickled)
‚îÇ   ‚îú‚îÄ‚îÄ vectorizer.pkl            # TF-IDF vectorizer (pickled)
‚îÇ   ‚îú‚îÄ‚îÄ labeled_emails.csv        # Training dataset (5,500 samples + 500 spam)
‚îÇ   ‚îú‚îÄ‚îÄ cleaned_emails.csv        # Cleaned email data
‚îÇ   ‚îú‚îÄ‚îÄ emails_5000.csv           # Original email samples
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt           # Python dependencies
‚îÇ   ‚îî‚îÄ‚îÄ .venv/                    # Virtual environment
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îî‚îÄ‚îÄ index.html                # Web UI (single HTML file)
‚îî‚îÄ‚îÄ REPORT.md                     # This file
```

---

## Feature Overview

### 1. Email Classification
Classifies emails into **5 categories**:
- üö® **Urgent** ‚Äî Critical issues requiring immediate attention
- üí∞ **Financial** ‚Äî Invoices, payments, budgets, financial notices
- üë• **HR** ‚Äî Employee-related matters, reviews, documents
- üìß **General** ‚Äî Standard queries and communication
- ‚ö†Ô∏è **Spam** ‚Äî Unsolicited, phishing, malicious content

### 2. Spam Detection
Two-layer spam detection:
- **Machine Learning**: Model trained to recognize spam patterns
- **Heuristic Rules**: Keyword matching + pattern analysis (URLs, capitalization, punctuation)

**Spam indicators (scored)**:
- High-priority keywords: winner, prize, claim, lottery, verify account, password, etc. (+2 pts each)
- Medium-priority keywords: win, free, offer, click, urgent, etc. (+1 pt each)
- Multiple URLs (+3 pts), all-caps sections (+2 pts), 3+ exclamation marks (+2 pts)
- **Threshold**: Score ‚â• 3 = Spam

---

## Installation & Setup

### Prerequisites
- Python 3.7+
- pip or conda
- Windows PowerShell or terminal

### Step 1: Clone/Extract Project
```powershell
cd "C:\Users\appan\Downloads\Email Classification System"
```

### Step 2: Set Up Virtual Environment
```powershell
cd backend
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
```

### Step 3: Train the Model (Optional)
If you want to retrain the model with the latest data:
```powershell
python train_model.py
```

Expected output:
```
Model training completed!
Training accuracy: 1.0
Testing accuracy: 1.0
```

### Step 4: Start Backend Server
```powershell
python app.py
```

Server runs on **http://127.0.0.1:5000**

### Step 5: Start Frontend (in another terminal)
```powershell
cd "C:\Users\appan\Downloads\Email Classification System"
python -m http.server 8000 --directory frontend
```

Frontend runs on **http://127.0.0.1:8000**

---

## API Reference

### Endpoint: `/classify`
**Method**: `POST`  
**URL**: `http://127.0.0.1:5000/classify`

#### Request
```json
{
  "email": "Your email text here"
}
```

#### Response
```json
{
  "success": true,
  "category": "Spam",
  "confidence": 0.379,
  "is_spam": true
}
```

#### Response Fields
- `success` (boolean): Request success status
- `category` (string): Predicted category (Urgent, Financial, HR, General, Spam)
- `confidence` (float): Prediction confidence (0.0 - 1.0)
- `is_spam` (boolean): Whether email is flagged as spam

---

## Model & Training

### Model Type
- **Algorithm**: Logistic Regression (scikit-learn)
- **Vectorizer**: TF-IDF (Term Frequency-Inverse Document Frequency)
- **Training/Test Split**: 80/20

### Training Data
- **Original samples**: 5,000 emails (Urgent, Financial, HR, General)
- **Spam samples**: 500 emails (added for improved detection)
- **Total**: 5,500 samples

### Model Performance
```
Training Accuracy: 100.0%
Testing Accuracy: 100.0%
```

### Training Steps
1. Load `labeled_emails.csv`
2. Extract text and category columns
3. Apply TF-IDF vectorization (stop words: English)
4. Split into train/test (80/20)
5. Train Logistic Regression model
6. Save model and vectorizer as pickles

To retrain:
```powershell
cd backend
python train_model.py
```

---

## Data Preprocessing

### Steps in `clean_dataset.py`:
1. **Tokenization**: Split text into words
2. **Stop word removal**: Filter common English words
3. **Lowercasing**: Normalize text case
4. **Label encoding**: Map category names to numeric labels

Example:
```
Input:  "URGENT: Critical issue detected"
Output: ["critical", "issue", "detected"] ‚Üí Urgent (label: 0)
```

---

## Usage Examples

### Example 1: Test via Web UI
1. Open http://127.0.0.1:8000
2. Click **‚ö†Ô∏è Spam** sample button
3. Click **üì§ Classify Email**
4. View results showing Category, Spam status, Confidence

### Example 2: Test via cURL
```bash
curl -X POST http://127.0.0.1:5000/classify \
  -H "Content-Type: application/json" \
  -d '{"email":"Congratulations! You won a prize. Click here to claim: http://example.com"}'
```

Response:
```json
{
  "success": true,
  "category": "Spam",
  "confidence": 0.38,
  "is_spam": true
}
```

### Example 3: Test via PowerShell
```powershell
$body = @{ email = "Your invoice for $500 is due next week." } | ConvertTo-Json
Invoke-RestMethod -Uri http://127.0.0.1:5000/classify `
  -Method Post -ContentType 'application/json' -Body $body
```

---

## Test Results

### Sample Classifications
| Email Text | Category | Spam | Confidence |
|-----------|----------|------|-----------|
| "Spam test: winner click here!" | Spam | ‚úì | 37.9% |
| "General: Can you share the notes?" | General | ‚úó | 99.2% |
| "You won a prize click now!!!" | Spam | ‚úì | 37.9% |
| "Invoice due next week payment needed" | Financial | ‚úó | 93.3% |
| "URGENT: Server down, immediate action required" | Urgent | ‚úó | 95%+ |
| "Employee performance review scheduled" | HR | ‚úó | 90%+ |

---

## Frontend Features

### Web UI Components
1. **Sample Buttons**: Quick load sample emails (Urgent, Financial, HR, General, Spam)
2. **Email Input**: Large textarea for pasting or typing email text
3. **Classify Button**: Sends email to backend API
4. **Result Card**: Displays category badge, spam status, and confidence bar
5. **Info Card**: Shows category descriptions

### Visual Indicators
- üö® **Urgent**: Red badge
- üí∞ **Financial**: Green badge
- üë• **HR**: Blue badge
- üìß **General**: Gray badge
- ‚ö†Ô∏è **Spam**: Dark red badge
- ‚úÖ **Not spam**: Dark green badge

### Responsive Design
- Mobile-friendly layout
- Works on desktop, tablet, and phone browsers
- Smooth animations and transitions

---

## Troubleshooting

### Issue: Backend won't start
**Solution**:
```powershell
# Check if port 5000 is in use
netstat -ano | findstr :5000
# Kill the process if needed
taskkill /PID <PID> /F
# Then restart
python app.py
```

### Issue: "Unable to connect to server" in frontend
**Causes**:
- Backend not running on port 5000
- Firewall blocking port 5000
- CORS issue (disabled in app.py)

**Solution**:
- Ensure backend is running: `python app.py`
- Check both servers are on localhost:5000 and localhost:8000
- Verify `CORS(app)` is enabled in app.py

### Issue: Model file not found (`email_model.pkl`)
**Solution**:
```powershell
cd backend
python train_model.py  # Regenerate model
```

### Issue: Missing dependencies
**Solution**:
```powershell
pip install -r requirements.txt
```

---

## Dependencies

### Backend (`requirements.txt`)
- **Flask** ‚Äî Web framework
- **Flask-CORS** ‚Äî Cross-Origin Resource Sharing
- **scikit-learn** ‚Äî Machine learning library
- **pandas** ‚Äî Data manipulation
- **numpy** ‚Äî Numerical computing

### Frontend
- HTML5, CSS3, JavaScript (vanilla, no frameworks)
- Works in all modern browsers

---

## Architecture

### Backend Flow
```
Email Input
    ‚Üì
TF-IDF Vectorization
    ‚Üì
Logistic Regression Model Prediction
    ‚Üì
Heuristic Spam Detection (scoring)
    ‚Üì
Override to 'Spam' if score ‚â• 3
    ‚Üì
Return: Category + Confidence + is_spam
```

### Frontend Flow
```
User Input (textarea)
    ‚Üì
POST to /classify API
    ‚Üì
Receive JSON response
    ‚Üì
Display category badge + spam status + confidence bar
    ‚Üì
Scroll to results
```

---

## Key Improvements Made

### v1 ‚Üí v2 Changes
1. ‚úÖ Added **Spam category** as a first-class classification label
2. ‚úÖ Enhanced spam detection with **weighted keyword scoring**
3. ‚úÖ Added **500 spam training samples** to model
4. ‚úÖ Implemented **multi-pattern detection** (URLs, caps, punctuation)
5. ‚úÖ **Retrained model** with 100% accuracy
6. ‚úÖ Added **‚ö†Ô∏è Spam button** in frontend UI
7. ‚úÖ Improved **heuristic threshold logic** for reliability

---

## Files Modified

- ‚úèÔ∏è `backend/app.py` ‚Äî Added improved spam detection logic
- ‚úèÔ∏è `backend/labeled_emails.csv` ‚Äî Added 500 spam training samples
- ‚úèÔ∏è `backend/email_model.pkl` ‚Äî Retrained with spam data
- ‚úèÔ∏è `backend/vectorizer.pkl` ‚Äî Updated vectorizer
- ‚úèÔ∏è `frontend/index.html` ‚Äî Added Spam button, styles, icon mappings
- ‚ú® `REPORT.md` ‚Äî This comprehensive documentation

---

## Future Enhancements

### Potential Improvements
1. **Deep Learning**: Replace Logistic Regression with LSTM/BERT for better NLP
2. **Real-time Learning**: Update model as users classify emails
3. **Database**: Store classification history and feedback
4. **Email Integration**: Direct API integration with Gmail, Outlook
5. **More Categories**: Add Support, Marketing, etc.
6. **Admin Dashboard**: View metrics, model performance, retraining logs
7. **Rate Limiting**: Add API rate limiting and authentication
8. **Batch Processing**: Classify multiple emails at once

---

## Support & License

This project is provided as-is. For issues or contributions, refer to the codebase structure and follow the setup instructions above.

**Last Updated**: December 4, 2025

---

## Quick Start Command (All in One)

```powershell
# Terminal 1: Backend
cd "C:\Users\appan\Downloads\Email Classification System\backend"
.\.venv\Scripts\Activate.ps1
python app.py

# Terminal 2: Frontend
cd "C:\Users\appan\Downloads\Email Classification System"
python -m http.server 8000 --directory frontend

# Open Browser
# http://127.0.0.1:8000
```

---
